# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger: none

pool: 
  # name: ADO-ISE-DEV-DESKTOP-WIN
  name: ADO-ISE-DEV-DESKTOP-TEST 

stages:
- stage: Test
  jobs: 
  - job: Test
    displayName: 'Test dd-cmdb-vmstate'
    steps:
        
    - task: AzureCLI@2
      inputs:
        azureSubscription: 'SVC_APPDEV_AT38995_DEVOPS'
        scriptType: 'pscore'
        scriptLocation: 'scriptPath'
        scriptPath: 'dd-cmdb-func-test/actions/runner.ps1'
        addSpnToEnvironment: true
        workingDirectory: 'dd-cmdb-func-test/actions/'
    # - task: PowerShell@2
    #   inputs:
    #     targetType: 'inline'
    #     script: '.\runner.ps1'
    #     pwsh: true
    #     workingDirectory: 'dd-cmdb-func-test\actions'
    
    - task: PublishTestResults@2
      inputs:
        testResultsFormat: 'NUnit'
        testResultsFiles: '**/*.xml'
        searchFolder: '$(System.DefaultWorkingDirectory)\dd-cmdb-func-test\actions'
        testRunTitle: 'dd-cmdb-vmstate'
        failTaskOnFailedTests: true       
